## EDA, Package Experimentation and Prelimanary Question Development

Installing and loading packages
```{r}
# Latest version of ENMtools on CRAN is not for R 4.3.1
# We must install ENMtools from authors github

# install.packages("devtools")
library(devtools)

# install_github("danlwarren/ENMTools")
library(ENMTools)

library(tidyverse)

# install.packages("leaflet")
library(leaflet)

# install.packages("terra")
library(terra)
```



How to Build an ENM tools species object

```{r}
raw_platypus <- read.csv("raw_data/Platypus5-10-23.csv")
platypusPresenceDF <- raw_platypus %>% 
  select(decimalLongitude, decimalLatitude)

# Create spatvector rather than dataframe
# platypusPresence <- vect(platypusPresenceDF, geom=c("decimalLongitude", "decimalLatitude"), crs="", keepgeom=FALSE)
```



```{r}
# Get some environmental data
# Gets bioclim layers
env <- raster::getData(name = "worldclim", res = 10, var = "bio")
# Should i use geodata package instead?

# Trim down the environmental layer to frame data better
env <- crop(env, extent(110, 155, -45, -8))
plot(env[[1]])
```



```{r}
# We package each lineage up in an ENMtools species object

platypus <- enmtools.species()
# Creates empty object with slots for various values

platypus$species.name <- "Ornithorhynchus anatinus"
platypus$presence.points <- platypusPresenceDF
#platypus$presence.points <- vect(platypusPresence, geom=c("decimalLongitude", "decimalLatitude"), crs="", keepgeom=FALSE)

# Check format of the enmtools.species
platypus <- check.species(platypus)

```

```{r}
platypus.mx <- enmtools.maxent(platypus, env)

platypus.mx$response.plots
```

Green is distribution of Environmental variable across background (Australia)
Red is distribution of presence points (frequency of which species appears across those variables)
Suitability Function our model has estimated (Marginal suitability)

```{r}
platypus.mx$training.evaluation
```
AUC = Area Under Curve


```{r}
platypus.bc <- enmtools.bc(platypus, env, test.prop = 0.3)

platypus.bc

```


```{r}
interactive.plot.enmtools.model(platypus.bc)
```




```{r}
# Raster layer

platypus.bc$suitability

```

Anything you can do with an evaluate function in DISMO you can do with:
```{r}
platypus.bc$training.evaluation
```

```{r}
platypus.bc$response.plots
```

When the green (Background) plot is not in line with the red and, it means there is a lot of area available that the species does not inhabit, indicating that that factor is important for the species

The blue suitability line is calculated from the bioclim function, and is showing the modeled preference for the species distribution

The following is the BIO variables

BIO1 = Annual Mean Temperature

BIO2 = Mean Diurnal Range (Mean of monthly (max temp - min temp))

BIO3 = Isothermality (BIO2/BIO7) (×100)

BIO4 = Temperature Seasonality (standard deviation ×100)

BIO5 = Max Temperature of Warmest Month

BIO6 = Min Temperature of Coldest Month

BIO7 = Temperature Annual Range (BIO5-BIO6)

BIO8 = Mean Temperature of Wettest Quarter

BIO9 = Mean Temperature of Driest Quarter

BIO10 = Mean Temperature of Warmest Quarter

BIO11 = Mean Temperature of Coldest Quarter

BIO12 = Annual Precipitation

BIO13 = Precipitation of Wettest Month

BIO14 = Precipitation of Driest Month

BIO15 = Precipitation Seasonality (Coefficient of Variation)

BIO16 = Precipitation of Wettest Quarter

BIO17 = Precipitation of Driest Quarter

BIO18 = Precipitation of Warmest Quarter

BIO19 = Precipitation of Coldest Quarter

```{r}
envBio8 <- env[[8]]
platypusBio8.bc <- enmtools.bc(platypus, envBio8)

platypusBio8.bc

interactive.plot(platypusBio8.bc)
```


```{r}
platypus.bc$response.plots[8]
```
Explaining bio8: 
BIO8 = Mean Temperature of Wettest Quarter

```{r}
plot(env[[8]])
```

Levins Niche Breadth 
How flat/uniform is this distribution of frequencies

Flat = very broad niche breath (high value) it is occurring consistently the recourse bins



## Find the suitability

```{r}
# install.packages("raster")
library(raster)

suitabilityRaster <- platypus.bc$suitability


# latitude <- 149.7128
# longitude <- -35.0060

# Create a SpatialPoints object for your location
# point <- SpatialPoints(cbind(longitude, latitude), proj4string = CRS(proj4string(suitabilityRaster)))

# Extract the suitability value
suitability_value <- extract(platypus.bc$suitability, cbind(136.467774, -25.107488))
print(suitability_value)

```
149.7128, -25.107488
  0.00508732
  0.004400273	

136.467774, -25.107488
  0
  YESSSS!!!!!!!!!!


## ESRI

```{r}
library(sf)
library(rgdal)

ogrListLayers("raw_data/SurfaceHydrologyPointsRegional.gdb")

raw_water <- sf::st_read(dsn = "raw_data/SurfaceHydrologyPointsRegional.gdb", layer = "HydroPoints")

plot(raw_water)
```



```{r}
print(table(water$FEATURETYPE))
```

Platypus can live only in freshwater rivers. As such we can remove the following points:
- Bore
- Swimming Pool
- Gnamma holes
- Rockholes (too small)
- Water storage point
- Lock
- Water Tank

```{r}
library(dplyr)

pointsKeep <- c("Native Well", "Spring", "Waterfall Point", "Dam", "Pool", "Waterhole")

waterData <- filter(raw_water, FEATURETYPE == pointsKeep)

print(table(waterData$FEATURETYPE))
```

```{r}
plot(waterData)
```


## Rivers Australia


```{r}
ogrListLayers("raw_data/rivers_australia_37252")

raw_rivers <- sf::st_read(dsn = "raw_data/rivers_australia_37252", layer = "rivers_australia_37252")
plot(raw_rivers)
```

```{r}
geometry_column <- raw_rivers$geometry

coordinates <- st_coordinates(geometry_column)
latitudes <- coordinates[, "Y"]
longitudes <- coordinates[, "X"]

latitudesDF <- as.data.frame(latitudes)
longitudesDF <- as.data.frame(longitudes)

riversLatLong <- latitudesDF
riversLatLong <- riversLatLong %>% 
  mutate()

ggplot(riversLatLong, aes(x = longitudes$longitudes, y = latitudes)) + 
  geom_point(size = 0.1)
  
```

Plenty of datapoints

```{r}
# Start with nothing

# Separate geometry from raw_rivers
geometry_column <- raw_rivers$geometry

# Create blank dataframe to add data to
extractRivers <- data.frame(matrix(ncol=5,nrow=0, dimnames=list(NULL, c("ARCID", "decimalLongitude", "decimalLatitude", "MAJ_NAME", "SUB_NAME"))))




for (x in 1:nrow(raw_rivers)) {

  # Unnest coordinates from list
  coordinates <- st_coordinates(geometry_column[x])
  
  for (y in 1:nrow(coordinates)) {
    tempDF <- data.frame(
      "ARCID" = raw_rivers[[x, "ARCID"]], 
      "decimalLongitude" = coordinates[y, "Y"], 
      "decimalLatitude" = coordinates[y, "X"], 
      "MAJ_NAME" = raw_rivers[[x, "MAJ_NAME"]], 
      "SUB_NAME" = raw_rivers[[x, "SUB_NAME"]])
    
    # use rbind() to add row to bottom of dataframe
    extractRivers <- rbind(extractRivers, tempDF)
    
  }
} 



nrow(extractRivers)
# 21281

nrow()
coordinates <- st_coordinates(geometry_column)
latitudes <- coordinates[, "Y"]
longitudes <- coordinates[, "X"]

latitudesDF <- as.data.frame(latitudes)
longitudesDF <- as.data.frame(longitudes)
```


