---
title: "Environmental Niche Modelling in R"
author: "Jack Richardson u7291420"
date: "4/10/23"
output:  
    html_document:
        toc: true
        toc_depth: 4
        theme: cosmo
        number_sections: false
        toc_float: true
        highlight: pygments
        fig_width: 8
        fig_height: 4
editor_options: 
  markdown: 
    wrap: 72
---

# Word/figure count

Words: [The number of words in your document, calculated using the
word_count() function at the end of this document] Figures: [The number
of figures in your document. You can just count these]

# Location on GitHub

<https://github.com/JackRicho/DS4B-final-project>

# Data Description

[A brief (\~100-200 words should be more than enough) description of the
dataset, referencing any key publications that go with it]

This project uses 3 datasets:

Atlas of Living Australias most current (as of 18/10/22) platypus occurrence records with no exclusions to data. Collected through a variety of research, conservation work and citizen science

Bioclimatic environment data that represents annual trends in climate, rainfall and seasonalty. Standard set of variables used in Species Distribution Modeling

Rivers Dataset containing geospatial point locations of Australia and New Zealand Rivers derived from World Wildlife Fund's (WWF) HydroSHEDS drainage direction layer and a stream network layer.

# Questions/Aims

This project has 2 aims:

-   To create a species distribution model of Platypus using the bioclim
    model.

-   To create a tool whereby users can input a location and they are
    told the suitability of that place to platypus habitation, and are
    told the nearest river where they may be able to find platypus

# Loading Libraries
```{r}
library(sf)
library(rgdal)
library(dplyr)
library(devtools)
library(ENMTools)
library(tidyverse)
library(leaflet)
library(terra)
```


# Raw data

[Explains how and where to get the exact raw data you got] [Is
reproducible by a person (required) and a machine (ideally)]

Platypus Data: Available through Atlas of Living Australia. Search:
*Ornithorhynchus anatinus*

available here:
<https://bie.ala.org.au/species/https://biodiversity.org.au/afd/taxa/ac61fd14-4950-4566-b384-304bd99ca75f>

acquired 18-10-2023 with no data exclusions.
Renamed (Speciescommonname)DD-MM-YY i.e. Platypus18-10-23

```{r}
# Read Platypus Data
raw_platypus <- read.csv("raw_data/Platypus18-10-23.csv")
```

Rivers Data: Available through Food and Agriculture Organization of the
United Nations: /AQUASTAT/Rivers of Australia and New Zealand
In ERSI data format (geospatial data)

available here:
<https://data.apps.fao.org/catalog/iso/6a53d768-1e20-46ea-92a8-c4040286057d>

```{r}
# Find Rivers Layer
ogrListLayers("raw_data/rivers_australia_37252")

# Read Rivers Data
raw_rivers <- sf::st_read(dsn = "raw_data/rivers_australia_37252", layer = "rivers_australia_37252")
```

Environment Data:
Environment data available through raster package
```{r}
# Get Environment Data
env <- raster::getData(name = "worldclim", res = 10, var = "bio")
```


# Data wrangling

[R chunks and prose which:] [Tidies up your raw data, outputs
tidied_data.csv] [Cleans up your tidied data, outputs cleaned_data.csv]

Clean platypus Data
```{r}
# Remove duplicates

# Remove Spatial Suspects

# Remove Location Uncertianty

# Remove Absence Records


```

Clean Rivers Data
```{r}
# View rivers by grouped area
raw_rivers %>% count(MAJ_NAME)
```
The following areas have no known sightings of platypus, and will thus be filtered from data to lessen computational load:

- Australia, North Coast
- Australia, West Coast
- New Zealand
- South Pacific Islands

Australia, interior slightly overlaps with some recorded sightings of platypus, so should be included in the dataset

```{r}
ausRegionKeep <- c(
  "Australia, East Coast", 
  "Australia, South Coast",
  "Australia, Interior", 
  "Murray - Darling", 
  "Tasmania")

limited_raw_rivers <- filter(raw_rivers, MAJ_NAME == ausRegionKeep)

limited_raw_rivers %>% count(MAJ_NAME)
```

Environmental data
```{r}
# Trim down the environmental layer to frame data better, include Australia only
env <- crop(env, extent(110, 155, -45, -8))

# Plot annual mean temperature environmental data
plot(env[[1]])
  # This ensures the data is loaded correctly. [Will likely remove in final submission]
```


# Sanity checks

[R chunks and prose which perform sanity checks on your cleaned data]
[Remember that this really just summarises that your data are OK after
you've cleaned them] [Most of the real sanity checks and data cleaning
go on in the data_cleaning.Rmd file]

# Addressing the questions/aims

```{r}
# Loading Data
raw_platypus <- read.csv("raw_data/Platypus5-10-23.csv")


# Create DF with only required data
platypusPresenceDF <- raw_platypus %>% 
  select(decimalLongitude, decimalLatitude)
  # I have attempted to create this in the SpatRaster format, however it encounters issues down the line


```

```{r}
# We package each lineage up in an ENMtools species object

# Creates empty object with slots for various values
platypus <- enmtools.species()

#Inhabit columns with required data
platypus$species.name <- "Ornithorhynchus anatinus"
platypus$presence.points <- platypusPresenceDF

# Check format of the enmtools.species
platypus <- check.species(platypus)
  # Populates object with required missing data
```

Maximum Entropy Models

```{r}
# enmTools package has functions that can create maximum entropy models
platypus.mx <- enmtools.maxent(platypus, env)

# Show 
platypus.mx$response.plots
```

Understanding Maximum Entropy Plots:

Green is distribution of Environmental variable across background, These
are the presence of environments that fit this condition across
Australia

Red is distribution of presence points (frequency of which species
appears across those variables)

Suitability Function our model has estimated (Marginal suitability)

```{r}
# See Maximum Entropy Data evaluation
platypus.mx$training.evaluation
```

BioClim Model

```{r}
# Use enmTools to create a bioclim model
platypus.bc <- enmtools.bc(platypus, env, test.prop = 0.3)
  # Bioclim uses the presence of observed insances and analyses them in relation to our 19 climatic variables to create a suitability plot
  # test.prop sets aside 30% of our data, allowing us to assess the accuracy of the model

# Create an interactive plot to view the model
interactive.plot.enmtools.model(platypus.bc)

# library(htmlwidgets)
# saveWidget(platypus.bc, file = 'D:\\GitHub\\DS4B-final-project\\processed_data\\BioclimExport')
```

# References

[References you have cited throughout your text]
