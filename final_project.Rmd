---
title: "Environmental Niche Modelling in R"
author: "Jack Richardson u7291420"
date: "4/10/23"
output:  
    html_document:
        toc: true
        toc_depth: 4
        theme: cosmo
        number_sections: false
        toc_float: true
        highlight: pygments
        fig_width: 8
        fig_height: 4
---

# Word/figure count

Words: [The number of words in your document, calculated using the word_count() function at the end of this document]
Figures: [The number of figures in your document. You can just count these]

# Location on GitHub

https://github.com/JackRicho/DS4B-final-project

# Data Description

[A brief (~100-200 words should be more than enough) description of the dataset, referencing any key publications that go with it]

# Questions/Aims

[A brief section which first states and then justifies the questions/aims of your EDA. Must provide evidence of independent research into what has been done before on these questions/aims. See above for examples.]

# Raw data

[Explains how and where to get the exact raw data you got]
[Is reproducible by a person (required) and a machine (ideally)]

# Data wrangling

[R chunks and prose which:]
[Tidies up your raw data, outputs tidied_data.csv]
[Cleans up your tidied data, outputs cleaned_data.csv]

# Sanity checks

[R chunks and prose which perform sanity checks on your cleaned data]
[Remember that this really just summarises that your data are OK after you've cleaned them]
[Most of the real sanity checks and data cleaning go on in the data_cleaning.Rmd file]

# Addressing the questions/aims

```{r}
# Loading Libraries
library(devtools)
library(ENMTools)
library(tidyverse)
library(leaflet)
library(terra)
```


```{r}
# Loading Data
raw_platypus <- read.csv("raw_data/Platypus5-10-23.csv")

# Create Example Dataframe
exPlatypusPresence <- data.frame(
  decimalLongitude = c(
    144.2939, 144.3134, 144.3205, 144.0553, 144.2675,
    144.3138, 143.7592, 144.3011, 144.2751, 144.2680,
    143.6186, 144.3202, 147.3429, 141.9596, 145.8290,
    147.6687, 145.2526, 144.5134, 143.7181, 147.5784
  ),
  decimalLatitude = c(
    -38.15573, -38.14578, -38.15364, -38.09789, -38.14520,
    -38.14503, -38.55246, -38.15016, -38.09380, -38.14564,
    -38.55681, -38.15415, -37.60680, -36.29010, -37.25910,
    -36.78980, -37.17330, -36.78410, -37.06260, -37.11190
  )
)

# Create DF with only required data
platypusPresenceDF <- raw_platypus %>% 
  select(decimalLongitude, decimalLatitude)
  # I have attempted to create this in the SpatRaster format, however it encounters issues down the line

# Get Bioclim layers (Environmental Data)
env <- raster::getData(name = "worldclim", res = 10, var = "bio")

# Trim down the environmental layer to frame data better, include Australia only
env <- crop(env, extent(110, 155, -45, -8))

# Plot annual mean temperature environmental data
plot(env[[1]])
  # This ensures the data is loaded correctly. [Will likely remove in final submission]
```


```{r}
# We package each lineage up in an ENMtools species object

# Creates empty object with slots for various values
platypus <- enmtools.species()

#Inhabit columns with required data
platypus$species.name <- "Ornithorhynchus anatinus"
platypus$presence.points <- platypusPresenceDF

# Check format of the enmtools.species
platypus <- check.species(platypus)
  # Populates object with required missing data
```

Maximum Entropy Models
```{r}
# enmTools package has functions that can create maximum entropy models
platypus.mx <- enmtools.maxent(platypus, env)

# Show 
platypus.mx$response.plots
```
Understanding Maximum Entropy Plots:

Green is distribution of Environmental variable across background, These are the presence of environments that fit this condition across Australia

Red is distribution of presence points (frequency of which species appears across those variables)

Suitability Function our model has estimated (Marginal suitability)

```{r}
# See Maximum Entropy Data evaluation
platypus.mx$training.evaluation
```

BioClim Model
```{r}
# Use enmTools to create a bioclim model
platypus.bc <- enmtools.bc(platypus, env, test.prop = 0.3)
  # Bioclim uses the presence of observed insances and analyses them in relation to our 19 climatic variables to create a suitability plot
  # test.prop sets aside 30% of our data, allowing us to assess the accuracy of the model

# Create an interactive plot to view the model
interactive.plot.enmtools.model(platypus.bc)

# library(htmlwidgets)
# saveWidget(platypus.bc, file = 'D:\\GitHub\\DS4B-final-project\\processed_data\\BioclimExport')
```


# References

[References you have cited throughout your text]


